<div class="update-who">
    <form
        [hidden]="activeTab != tabLabels[0]"
        class="who-update-form basic"
        #basicForm
        (ngSubmit)="onWhoUpdate()"
    >
        <div *ngIf="user.isStaff && user.userId !== record.core?.contributor_id" class="staff-specific">
            <div class="name-inputs">
                <section class="form-input no-margin-top">
                    <label>
                        <span>First Name: <em class="required">*</em></span>
                        <input
                            type="text"
                            name="first_name"
                            placeholder="First name of this person"
                            [value]="record.core?.contributor?.first_name || ''"
                            required
                        />
                    </label>
                </section>


                <section class="form-input">
                    <label>
                        <span>Initials:</span>
                        <input
                            type="text"
                            name="initials"
                            placeholder="Any initials of this person"
                            [value]="record.core?.contributor?.initials || ''"
                        />
                    </label>
                </section>


                <section class="form-input">
                    <label>
                        <span>Last Name: <em class="required">*</em></span>
                        <input
                            type="text"
                            name="last_name"
                            placeholder="Last name of this person"
                            [value]="record.core?.contributor?.last_name || ''"
                            required
                        />
                    </label>
                </section>
            </div> <!-- /name-inputs -->


            <section class="form-input">
                <label class="input-spinner-holder">
                    <span>Where this person resides: <em class="required">*</em></span>

                    <img
                        *ngIf="!countryList"
                        class="input-spinner"
                        src="/assets/img/icons/loader/loading.gif"
                        alt="spinner"
                    />

                    <select name="country_id" required>
                        <option value="">--------------</option>
                        <option
                            *ngFor="let country of countryList"
                            [value]="country.country_id"
                            [innerHTML]="country.short_name"
                            [selected]="country.country_id === record.core?.contributor?.country_id"
                        ></option>
                    </select>
                </label>
            </section>


            <input type="hidden" name="editor_is_staff" value="true" />
        </div> <!-- /staff-specific -->


        <section class="form-input image-section">
            <label>
                <span>Upload a profile picture (Max 10MB):</span>
                <input #imageInput type="file" name="image_file" (change)="processImage($event)" />
                <input #imageAction hidden="true" type="hidden" name="image_action" [value]="imageActionKey" />
            </label>


            <div [ngStyle]="{'display': showImage ? 'block' : 'none'}" class="image-container">
                <img #previewImage [src]="imageUrl + '/' + record.img" alt="Record Image" />
                <span (click)="removeImage()">X</span>
            </div> <!-- image-container -->


            <p *ngIf="fileTooBigError" class="error">File size is too big. Maximum allowed size is 10MB</p>
        </section>


        <section class="form-input">
            <label>
                <span>Please include a link to your homepage or online profile (Google Scholar, LinkedIn, etc.):</span>
                <input
                    type="text"
                    name="url"
                    placeholder="Link to your online profile"
                    [value]="record.url"
                />
            </label>
        </section>


        <fieldset class="organization-info">
            <legend>Organization Information</legend>

            <div class="primary-organization">
                <section class="form-input">
                    <label class="input-spinner-holder">
                        <span>Primary institution you are affiliated with:</span>

                        <img
                            *ngIf="!allOrganizations"
                            class="input-spinner"
                            src="/assets/img/icons/loader/loading.gif"
                            alt="spinner"
                        />

                        <select name="primary_affiliation">
                            <option value="">--------------</option>
                            <option
                                *ngFor="let organization of allOrganizations"
                                [value]="organization.issf_core_id"
                                [innerHTML]="organization.organization_name"
                                [selected]="organization.issf_core_id === primaryOrganizationId"
                            ></option>
                        </select>
                    </label>
                </section>

                <p class="add-new-organization">
                    <a
                      [routerLink]="['/contribute', 'organization']"
                      target="blank"
                    >Can't find the organization? Click here to add your organization</a>
                </p>
            </div> <!-- /primary-organization -->


            <section class="form-input">
                <label class="input-spinner-holder">
                    <span>
                        Select all other SSF Organizations/Networks/Associations that you are a member of.
                        If you cannot find the organization, use <a [routerLink]="['/contribute', 'organization']" target="blank">Contribute option to add</a>:
                    </span>
                </label>

                <div class="filterable-select-box">
                    <input class="filterable-select-filterer" type="text" placeholder="Search organization ..." (keyup)="filterOrganizations($event)"/>
                    <img
                        *ngIf="!allOrganizations"
                        class="input-spinner filterable-select-spinner"
                        src="/assets/img/icons/loader/loading.gif"
                        alt="spinner"
                    />
                    <div class="filterable-select-options">
                        <ng-container *ngFor="let organization of allOrganizations">
                            <p
                                *ngIf="organization.issf_core_id !== primaryOrganizationId"
                                class="select-option"
                                (click)="onOrganizationSelect($event)"
                                [ngClass]="{selected: affiliatedOrganizationsId.includes(organization.issf_core_id)}"
                                [attr.value]="organization.issf_core_id"
                                [innerHTML]="organization.organization_name"
                            ></p>
                        </ng-container>
                    </div>
                </div> <!-- /filterable-select-box -->

                <input
                    #selectedOrganizations
                    type="hidden"
                    name="selected_organizations"
                    [value]="selectedOrganizationIds"
                />
            </section>


            <!-- <div class="new-organization">
                <section class="form-input">
                    <label>
                        <span>Primary Institutional/Organizational Affiliation:</span>
                        <input
                            type="text"
                            name="affiliation"
                            placeholder="Primary institution that you are affiliated with"
                            [value]="record.affiliation"
                        />
                    </label>
                </section>


                <section class="form-input">
                    <label>
                        <span>Address line 1:</span>
                        <input
                            type="text"
                            name="address1"
                            placeholder="Address line 1"
                            [value]="record.address1"
                        />
                    </label>
                </section>


                <section class="form-input">
                    <label>
                        <span>Address line 2:</span>
                        <input
                            type="text"
                            name="address2"
                            placeholder="Address line 2"
                            [value]="record.address2"
                        />
                    </label>
                </section>


                <section class="form-input">
                    <label class="input-spinner-holder">
                        <span>Country:</span>
                        <img
                            *ngIf="!countryList"
                            class="input-spinner"
                            src="/assets/img/icons/loader/loading.gif"
                            alt="spinner"
                        />
                        <select name="country">
                            <option
                                *ngFor="let country of countryList"
                                [value]="country.country_id"
                                [innerHTML]="country.short_name"
                                [selected]="record.country === country.short_name"
                            ></option>
                        </select>
                    </label>
                </section>


                <section class="form-input">
                    <label>
                        <span>City/town:</span>
                        <input
                            type="text"
                            name="city_town"
                            placeholder="Name of the city or town"
                            [value]="record.city_town"
                        />
                    </label>
                </section>


                <section class="form-input">
                    <label>
                        <span>Province/state:</span>
                        <input
                            type="text"
                            name="prov_state"
                            placeholder="Province or state"
                            [value]="record.province_state"
                        />
                    </label>
                </section>


                <section class="form-input">
                    <label>
                        <span>Postal code:</span>
                        <input
                            type="text"
                            name="postal_code"
                            placeholder="Please provide the postal code"
                            [value]="record.postal_code"
                        />
                    </label>
                </section>
            </div> -->
            <!-- /new-organization -->
        </fieldset>

        <br><button type="submit" class="no-margin-left">Submit</button>
    </form>


    <form
        [hidden]="activeTab != tabLabels[1]"
        class="who-update-form researcher-info"
        #researcherInfo
        (ngSubmit)="onWhoUpdate()"
    >
        <section class="form-input no-margin-top">
            <label>
                <span>Are you a SSF researcher? <em class="required">*</em></span>
                <select
                    name="is_researcher"
                    required
                >
                    <option value="true" [selected]="record.is_researcher">Yes</option>
                    <option value="false" [selected]="!record.is_researcher">No</option>
                </select>
            </label>
        </section>


        <section class="form-input">
            <label>
                <span>Number of publications in last 10 years:</span>
                <input
                    type="number"
                    name="number_publications"
                    placeholder="Number of publications in last 10 years"
                    [value]="record.number_publications"
                />
            </label>
        </section>


        <div class="toggle-container" togglerContainer>
            <section class="form-input">
                <label class="header-label">
                    <span>Highest level of education:</span>
                    <select
                        name="education_level"
                        (change)="toggleOnOther($event, 'Other')"
                    >
                        <option value="" [selected]="record.education_level == ''">--------------</option>
                        <option
                            *ngFor="let eduLevel of educationLevels"
                            [value]="eduLevel"
                            [selected]="eduLevel == record.education_level"
                            [innerHTML]="eduLevel"
                        ></option>
                        <option value="Other" [selected]="isOtherEducationLevel">Other</option>
                    </select>
                </label>
            </section>


            <section class="form-input" [hidden]="!isOtherEducationLevel" toggleDisable>
                <label class="header-label">
                    <span>Please specify: <em class="required">*</em></span>
                    <input
                        type="text"
                        name="other_education_level"
                        placeholder="Please specify other education level"
                        [value]="record.other_education_level"
                        [disabled]="!isOtherEducationLevel"
                        [required]="isOtherEducationLevel"
                        toggleOnChange
                    />
                </label>
            </section>
        </div> <!-- /toggleContainer -->


        <section class="form-input">
            <label>
                <span>Research method(s) or approach(es) most commonly applied (e.g. ethnographic, survey, etc.):</span>
                <textarea
                    type="text"
                    name="research_method"
                    placeholder="Most commonly applied research methods or approaches"
                    [value]="record.research_method"
                ></textarea>
            </label>
        </section>


        <section class="form-input">
            <label>
                <span>List up to three main issues your research aims to address:</span>
                <textarea
                    type="text"
                    name="issues_addressed"
                    placeholder="Three main issues your research aims to address"
                    [value]="record.issues_addressed"
                ></textarea>
            </label>
        </section>


        <br><button type="submit" class="no-margin-left">Submit</button>
    </form>


    <form
        [hidden]="activeTab != tabLabels[2]"
        class="who-update-form theme"
        #themeForm
        (ngSubmit)="onWhoUpdate()"
    >
        <app-theme [themes]="record.theme_issues"></app-theme>
        <br><button type="submit" class="no-margin-left">Submit</button>
    </form>


    <form
        [hidden]="activeTab != tabLabels[3]"
        class="who-update-form species"
        #speciesForm
        (ngSubmit)="onWhoUpdate()"
    >
        <app-species-link
            label1 = "Common species name"
            label2 = "Scientific/Latin name"
            field1 = "common"
            field2 = "scientific"
            [values]="record.species"
            [field1Type] = "species_link_types['INPUT']"
        ></app-species-link>

        <br><button type="submit" class="no-margin-left">Submit</button>
    </form>


    <form
        [hidden]="activeTab != tabLabels[4]"
        class="who-update-form links"
        #linksForm
        (ngSubmit)="onWhoUpdate()"
    >
        <app-species-link
            label1 = "Link type"
            label2 = "Link address"
            field1 = "link-type"
            field2 = "link-address"
            [values]="record.external_links"
            [field1Type] = "species_link_types['SELECT']"
        ></app-species-link>

        <br><button type="submit" class="no-margin-left">Submit</button>
    </form>
</div> <!-- /update-who -->
