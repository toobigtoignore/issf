Array.prototype.contains=function(t){for(var e=this.length;e--;)if(this[e]==t)return!0;return!1};var HJExtension=new function(){function t(e){var i=$(this).closest(".FormSetGrowable"),n=parseInt($(i.find('input[name$="-TOTAL_FORMS"]')[0]).val());n>1&&($formset=$(this).closest(".advancedSearchPanelTabTable"),$formset.next("hr").detach(),$formset.detach(),n--,$(i.find('input[name$="-TOTAL_FORMS"]')[0]).val(n),i.find(".advancedSearchPanelTabTable").each(function(t){$(this).find("select").each(function(){k($(this),t)})}),n>1?i.find(".advancedSearchPanelTabRemoveButton").show():i.find(".advancedSearchPanelTabRemoveButton").hide(),$(".advancedSearchPanelTabRemoveButton").each(function(){$(this).unbind(),$(this).click(t)}))}function e(){var t=arguments[0],i=$(this).parent().parent(),s=i.clone(),c=$(this).parent();$(this).unbind().detach();var d=$(C);d.click($.proxy(n,null,t)),c.append(d),c.find(".mainCharacteristicsUnitsWrapper").detach();var u=i.find('input[placeholder="Other Value"]');u.length>0&&u.is(":visible")&&c.append('<div class="mainCharacteristicsUnitsWrapper">&nbsp;</div>'),s.prop("id",(new Date).getTime());var p=s.children("td:nth-child(1)").find("select");p.children("option").removeAttr("selected"),p.children("option").first().attr("selected","selected"),p.change(a);var f=s.children("td:nth-child(1)").children('input[name$="other_value"]');f.val(""),f.hasClass("hidden")||f.addClass("hidden"),f.focusin(r),f.focusout(h);var m=s.children("td:nth-child(1)").children('input[name$="other_theme_issue"]');m.val(""),m.hasClass("hidden")||m.addClass("hidden"),m.focusin(r),m.focusout(h);var v=$(s.children("td:nth-child(2)")).children("button");v.click($.proxy(e,null,t)),s.find(".mainCharacteristicsUnitsWrapper").each(function(){0==$(this).text().trim().length&&$(this).detach()});var b=o(t),g=/[0-9]+/g;s.find("input").each(function(){var t=$(this).attr("name"),e=$(this).prop("id");$(this).attr("name",t.replace(g,b)),$(this).prop("id",e.replace(g,b)),t.indexOf("selected_attribute_id")>0&&$(this).val(""),t.indexOf("row_number")>0&&$(this).val(b+2e6)}),s.find("select").each(function(){var t=$(this).attr("name"),e=$(this).prop("id");$(this).attr("name",t.replace(g,b)),$(this).prop("id",e.replace(g,b))}),l(t),s.children('input[type="hidden"]').attr("data-leave-page-exclude","true"),s.find('input[name$="additional"]').attr("value","").val(""),i.after(s.hide()),s.slideDown("slow");var x=$('<div class="deleteCheckBoxContainer"><input id="id_mainattributeview_set-'+b+'-DELETE" name="mainattributeview_set-'+b+'-DELETE" type="checkbox"></div>');t.find(".FormSet").first().append(x)}function n(){var t=arguments[0];console.log("form action: "+t.attr("action")),$(".tooltip").hide();var e=$(this).parent().parent(),i=/[0-9]+/g,n=e.children("input").first().attr("name").match(i)[0];console.log("Delete setcount: "+n);s(t),parseInt(t.find('input[name$="INITIAL_FORMS"][type="hidden"]').val()),parseInt(t.find('input[name$="TOTAL_FORMS"][type="hidden"]').val());e.slideUp("slow"),e.find("input").each(function(){var e=$(this).detach();e.attr("type","hidden"),t.append(e)}),e.find("select").each(function(){var e=$(this).detach(),i=e.attr("name"),n=e.prop("id"),a=e.val(),r=$('<input type="hidden" id="'+n+'" name="'+i+'" value="'+a+'">');t.append(r)}),e.detach(),t.find('input[type="checkbox"]').each(function(){var t=$(this).attr("name");return t.indexOf("-"+n+"-DELETE")>0?(console.log("Checking deletebox for: "+t),$(this).prop("checked",!0),!1):void 0})}function a(){$(this).next('input[type="hidden"][name$="other_value"]').val(""),"Other"==$(this).children("option:selected").text().trim()?$(this).next('input[name$="other_value"]').removeClass("hidden"):$(this).next('input[name$="other_value"]').addClass("hidden"),$(this).next('input[type="hidden"][name$="other_theme_issue"]').val(""),"Other"==$(this).children("option:selected").text().trim()?$(this).next('input[name$="other_theme_issue"]').removeClass("hidden"):$(this).next('input[name$="other_theme_issue"]').addClass("hidden");var t=$(this);$(this).parent().next().find(".mainCharacteristicsUnitsWrapper").detach(),$(this).parent().find("input").each(function(){$(this).is(":visible")&&t.parent().next().find("button").after('<div class="mainCharacteristicsUnitsWrapper">&nbsp;</div>')}),$(this).closest(".profile-attributes-row").find(".gqAddButton").click(),console.log("select change click")}function r(){$(this).addClass("otherInputOnFocus"),$(this).prev("select").addClass("otherSelectOnFocus")}function h(){$(this).removeClass("otherInputOnFocus"),$(this).prev("select").removeClass("otherSelectOnFocus")}function o(t){var e=t.find('input[type="hidden"][name$="TOTAL_FORMS"]'),i=parseInt(e.val());return i}function s(t){var e=t.find('input[type="hidden"][name$="INITIAL_FORMS"]'),i=parseInt(e.val());return i}function l(t){var e=t.find('input[type="hidden"][name$="TOTAL_FORMS"]'),i=parseInt(e.val());e.val(i+1)}var c=!1,d="You still have unsaved data.",u="",p=[];this.init=function(){f(),m(),g(),v(),b(),O(),F(),y(),x(),S()},this.SetLeavePageWarningMessage=function(t){d=t};var f=function(){console.log("-->[init]MarkOutEmptyContainers"),$("p").each(function(){0==$(this).children().length&&0==$(this).text().length&&$(this).addClass("EmptyContainer")}),$("div").each(function(){0==$(this).children().length&&0==$(this).text().length&&$(this).addClass("EmptyContainer")})},m=function(){console.log("-->[init]HideOtherFieldsGlobal"),$('.FormSet input[type="text"][name*=other]').each(function(){$(this).addClass("FormSetOtherInputField"),$(this).prev().attr("for")==$(this).prop("id")&&$(this).prev().addClass("FormSetOtherInputLabel"),$(this).next().attr("for")==$(this).prop("id")&&$(this).next().addClass("FormSetOtherInputLabel")}),$(".FormSet").each(function(){$(this).children('input[type="checkbox"][name*="other"]').each(function(){var t="";if($(this).prev().attr("for")==$(this).prop("id")&&(t=$(this).prev().text().trim().toLowerCase()),$(this).next().attr("for")==$(this).prop("id")&&(t=$(this).next().text().trim().toLowerCase()),console.log($(this).prop("id")+":"+t),0==t.indexOf("other")){var e=$(this).is(":checked");e||w($(this)),$(this).after("<br>")}})}),$(".FormSet select").each(function(){0==$(this).children("option:last-child").text().trim().toLowerCase().indexOf("other")&&($(this).val()==$(this).children("option:last-child").val()||w($(this)))}),$(".FormSet ul").each(function(){var t=$(this).children("li:last-child").text().trim().toLowerCase(),e=$(this).children("li:last-child").find('input[type="checkbox"]').length>0;if("other"==t&&e){var i=$(this).children("li:last-child").find('input[type="checkbox"]').is(":checked");i||w($(this))}})},v=function(){console.log("-->[init]ToggleChecklistOtherField"),$(".FormSet ul").each(function(){var t=$(this).children("li:last-child").text().trim().toLowerCase(),e=$(this).children("li:last-child").find('input[type="checkbox"]').length>0,i=$(this);"other"==t&&e&&$(this).children("li:last-child").find('input[type="checkbox"]').on("change",function(){var t=$(this).is(":checked");t?_(i):w(i)})})},b=function(){console.log("-->[init]ToggleChecklistOtherField"),$(".FormSet").each(function(){$(this).children('input[type="checkbox"][name*="other"]').each(function(){var t="";$(this).prev().attr("for")==$(this).prop("id")&&(t=$(this).prev().text().trim().toLowerCase()),$(this).next().attr("for")==$(this).prop("id")&&(t=$(this).next().text().trim().toLowerCase()),0==t.indexOf("other")&&$(this).on("change",function(){var t=$(this).is(":checked");t?_($(this)):w($(this))})})})},g=function(){console.log("-->[init]SetUpSelectOtherFieldToggle"),$(".FormSet select").each(function(){0==$(this).children("option:last-child").text().trim().toLowerCase().indexOf("other")&&$(this).on("change",function(){$(this).val()==$(this).children("option:last-child").val()?_($(this)):w($(this))})})},x=function(){console.log("-->[init]FormsetToggler - for GeographicScope Page"),$(".FormSetToggler > ul").on("click",function(t){var e=$(t.target);if("input"==t.target.tagName.toLowerCase()){$(this).parents("form").find("span.error").remove();var i=$(e.parent().parent()).index();$(".FormSetTogglable").hide(),$($(".FormSetTogglable")[i]).fadeIn("fast")}}),$(".FormSetToggler input:radio").each(function(){if($(this).is(":checked")){var t=$(this).parent().parent().index();$(".FormSetTogglable").hide(),$($(".FormSetTogglable")[t]).fadeIn("fast")}})},S=function(){console.log("-->[init]LeavePageWarning"),u=L(),$("input:submit").click(function(){$(this).attr("data-submit","on")}),$("button.bt-submit").click(function(){$(this).attr("data-submit","on")}),$("button.submit").click(function(){$(this).attr("data-submit","on")}),window.onbeforeunload=function(){var t=L();if(c=!1,$("input:submit").each(function(){"on"==$(this).attr("data-submit")&&(c=!0)}),$("button.bt-submit").each(function(){"on"==$(this).attr("data-submit")&&(c=!0)}),$("button.submit").each(function(){"on"==$(this).attr("data-submit")&&(c=!0)}),c);else if(u!=t)return d},window.onunload=function(){var t=L();if(c=!1,$("input:submit").each(function(){"on"==$(this).attr("data-submit")&&(c=!0)}),$("button.bt-submit").each(function(){"on"==$(this).attr("data-submit")&&(c=!0)}),$("button.submit").each(function(){"on"==$(this).attr("data-submit")&&(c=!0)}),c);else if(u!=t)return d}},O=function(){console.log("-->[init]InsertBreakLinesToFormSets"),$(".FormSetGrowable").each(function(t){$(this).attr("formset-num",t);for(var e=parseInt($($(this).children('input[name$="-TOTAL_FORMS"]')[0]).val()),i=($(this).children().length-3)/e,t=$(this).children().length-1;t>2;)$($(this).children()[t]).after("<hr>"),t-=i})},F=function(){console.log("-->[init]DynamicFormSet"),$(".FormSetGrowable").each(function(t){$(this).attr("formset-num",t);var e=parseInt($($(this).children('input[name$="-TOTAL_FORMS"]')[0]).val()),i=$("<div>");if(i.append($(this).children().clone()),i.children('input[name$="TOTAL_FORMS"]').remove(),i.children('input[name$="INITIAL_FORMS"]').remove(),i.children('input[name$="MAX_NUM_FORMS"]').remove(),e>1)for(var n=i.children().length/e,a=0;n*(e-1)>a;a++)$(i.children()[0]).remove();p.push(i);var r=$('<button class="addFormSetButton blueOrangeButton medium radius" type="button">Add another</button>');$(this).not("div.GeogScopeForm").append(r)}),$(".advancedSearchPanelTabRemoveButton").hide(),$(".advancedSearchPanelTabRemoveButton").each(function(){$(this).click(t)}),$(".addFormSetButton").on("click",function(e){e.preventDefault();var i=$(this),n=parseInt($($(this).siblings('input[name$="-TOTAL_FORMS"]')[0]).val());console.log("[Add another button click]numberOfSetsPresent: "+n);var a=parseInt($(this).parent().attr("formset-num")),r=p[a].clone();if($(this).parent().hasClass("advancedSearchPanelTab")){var h=r.find("#ti-attr select").first(),o=r.find("#ti-attr-val select").first();o.hide(),h.on("change",function(){var t=$(this).val();o.empty(),o.show(),themeissueValues.themeissueID.forEach(function(e,i){e==t&&o.append($("<option></option>").attr("value",themeissueValues.themeissueValueID[i]).text(themeissueValues.themeissueLabel[i]))})});var s=r.find("#char-attr select").first(),l=r.find("#char-attr-val select").first();l.hide(),s.on("change",function(){var t=$(this).val();l.empty(),l.show(),attributeValues.attributeID.forEach(function(e,i){e==t&&l.append($("<option></option>").attr("value",attributeValues.attributeValueID[i]).text(attributeValues.valueLabel[i]))})})}I(r),B(r),console.log("[Add another button click]newformset children count: "+r.children().length),r.children("table.advancedSearchPanelTabTable").length<=0?(console.log("$newformset html: "+r.html()),r.children().each(function(){k($(this),n),$(this).insertBefore(i)})):(r.find("select").each(function(){k($(this),n)}),r.children().each(function(){$(this).insertBefore(i)})),n++,$($(this).siblings('input[name$="-TOTAL_FORMS"]')[0]).val(n),n>1?$(this).parent().find(".advancedSearchPanelTabRemoveButton").show():$(this).parent().find(".advancedSearchPanelTabRemoveButton").hide(),$(".advancedSearchPanelTabRemoveButton").each(function(){$(this).unbind(),$(this).click(t)})})},T='<button class="gqAddButton blueOrangeButton QualitativeButton medium radius" style="padding:0 !important; margin:0 !important; height:0 !important; width:0 !important;" type="button">+</button>',C='<button class="gqRemoveButton orangeRedButton QualitativeButton medium radius has-tip" data-tooltip aria-haspopup="true" title="Click here to remove this value." type="button"><i class="step fi-minus"></i></button>',y=function(){console.log("-->[init]GrowableQualitativeSelection"),$("form.accordionFormsetGrowable").each(function(){console.log("----------Formset: "+$(this).attr("action")+"-------------");var t=$(this),o=[];for(t.find("tr.profile-attributes-row").each(function(){if($(this).children('td[data-attr-type="Qualitative"]').length>0){$(this).prop("id",(new Date).getTime());var t=$(this).prevAll(".profile-label-row:first").text().trim();$(this).attr("data-attribute-name",t),o.contains(t)||o.push(t);var e=$(this).children("td:nth-child(1)").children("select");e.change(a);var i=e.children("option:selected").text().trim(),n=$(this).children('input[type="hidden"][name$="other_value"]').detach();n.attr("placeholder","Other Value"),n.attr("type","text"),"Other"!=i&&n.addClass("hidden"),n.focusin(r),n.focusout(h),e.after(n);var s=$(this).children('input[type="hidden"][name$="other_theme_issue"]').detach();s.attr("placeholder","Other Value"),s.attr("type","text"),"Other"!=i&&s.addClass("hidden"),s.focusin(r),s.focusout(h),e.after(s)}}),i=0;i<o.length;i++){var s=o[i],l=t.find('tr.profile-attributes-row[data-attribute-name="'+s+'"]'),c=null;for(j=0;j<l.length;j++){if(1==l.length){var d=$(T);d.click($.proxy(e,null,t)),$(l[j]).children("td:nth-child(2)").append(d),c=$(l[j])}else if(j==l.length-1){var d=$(T);d.click($.proxy(e,null,t)),$(l[j]).children("td:nth-child(2)").append(d),c=$(l[j])}else{var u=$(C);u.click($.proxy(n,null,t)),$(l[j]).children("td:nth-child(2)").append(u)}null!=c&&c.find("select").val().trim().length>0&&c.find(".gqAddButton").click()}}t.find("tr.profile-attributes-row").each(function(){var t=$('<div class="mainCharacteristicsUnitsWrapper">&nbsp;</div>'),e=$(this).find("select");e.length>0&&"Other"==e.find("option:selected").text().trim()&&$(this).find(".QualitativeButton").after(t);var i=$(this).find('input[name$="additional"]');i.length>0&&$(this).find(".QualitativeButton").after(t);var i=$(this).find('input[name$="other_value"]');i.length>0&&i.is(":visible")&&$(this).find(".QualitativeButton").after(t)})})},k=function(t,e){var i=t.attr("for"),n=t.attr("id"),a=t.attr("name");console.log(i),console.log(n),console.log(a),"undefined"!=typeof i&&i!==!1&&(i=i.replace(/_set-\d*-/i,"_set-"+e+"-"),t.attr("for",i),t.attr("for",i.replace(/form-\d*-/i,"form-"+e+"-"))),"undefined"!=typeof n&&n!==!1&&(n=n.replace(/_set-\d*-/i,"_set-"+e+"-"),t.attr("id",n),t.attr("id",n.replace(/form-\d*-/i,"form-"+e+"-"))),"undefined"!=typeof a&&a!==!1&&(a=a.replace(/_set-\d*-/i,"_set-"+e+"-"),t.attr("name",a),t.attr("name",a.replace(/form-\d*-/i,"form-"+e+"-")))},w=function(t){for(var e=t.index(),i=t.parent(),n=e;n<i.children().length;n++)if($(i.children()[n]).hasClass("FormSetOtherInputField")){$(i.children()[n]).hide(),$(i.children()[n-1]).hasClass("FormSetOtherInputLabel")&&$(i.children()[n-1]).hide(),n+1<i.children().length&&$(i.children()[n-1]).hasClass("FormSetOtherInputLabel")&&$(i.children()[n-1]).hide();break}},_=function(t){for(var e=t.index(),i=t.parent(),n=e;n<i.children().length;n++)if($(i.children()[n]).hasClass("FormSetOtherInputField")){$(i.children()[n]).show(),$(i.children()[n-1]).hasClass("FormSetOtherInputLabel")&&$(i.children()[n-1]).show(),n+1<i.children().length&&$(i.children()[n-1]).hasClass("FormSetOtherInputLabel")&&$(i.children()[n-1]).show();break}},L=function(){var t="";return $(".FormSet").each(function(){t+="{",$(this).find('input[data-leave-page-exclude!="true"]').each(function(){"undefined"!==$(this)&&$(this)!==!1&&null!=$(this).val()&&(t+="checkbox"==$(this).attr("type")||"radio"==$(this).attr("type")?$(this).is(":checked"):$(this).val().trim())}),$(this).find("select").each(function(){if("undefined"!==$(this)&&$(this)!==!1&&null!=$(this).val()){var e=$(this).val();if(e instanceof Array){for(var i="",n=0;n<e.length;n++)i+=e[n];e=i}"undefined"!=typeof e&&null!==e&&(t+=e.trim())}}),$(this).find("textarea").each(function(){t+=$(this).val()}),t+="}"}),t},I=function(t){t.find("select").each(function(){0==$(this).children("option:last-child").text().trim().toLowerCase().indexOf("other")&&$(this).on("change",function(){$(this).val()==$(this).children("option:last-child").val()?_($(this)):w($(this))})})},B=function(t){t.find("ul").each(function(){var t=$(this).children("li:last-child").text().trim().toLowerCase(),e=$(this).children("li:last-child").find('input[type="checkbox"]').length>0,i=$(this);"other"==t&&e&&$(this).children("li:last-child").find('input[type="checkbox"]').on("change",function(){var t=$(this).is(":checked");t?_(i):w(i)})})}};